
<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>ぬり絵テスト</title>
	<style type="text/css">
		/* h1のCSS */
		h1 {
			margin-left: 50px;
			color: #cccccc;
		}

		/* キャンバスのCSS */
		#coloring {
			border: solid 1px #cc77cc;
			margin: 0px 50px;
		}
        #coloring2 {
            position: absolute;
            z-index: 2;
			border: solid 1px #77cccc;
			margin: 0px 50px;
		}
        #colorings {
            display: inline-flex;
		}

		/* カラーパレットのCSS */
		#palette {
			margin: 0px 50px;
			padding: 0px;
		}

		/* 色ボタンのCSS */
		.Color {
			margin: 5px;
			padding: 0px;
			width: 30px;
			height: 30px;
			border: solid 1px #CCCCCC;
		}
		/* ペンサイズ */
		#penWidth {
			margin: 50px;
			padding: 0px;
		}

		#penWidth button {
			border: none;
			background-color: #FFFFFF;
			width: 30px;
			height: 30px;
			padding: 0px;
		}
		.penSize {
			border-radius: 50%;
			background-color: #000000;
			border: solid 1px #CCCCCC;
			margin: auto;
		}

		#penSizeL {
			width: 20px;
			height: 20px;
		}

		#penSizeM {
			width: 10px;
			height: 10px;
		}

		#penSizeS {
			width: 5px;
			height: 5px;
		}
	</style>
</head>
<body>
	<!-- タイトルを表示する -->
	<h1>ぬり絵をやろう！(test1)</h1>
	<!-- キャンバスを置く -->
    <div id="colorings">
	<canvas id="coloring" width="400" height="300"></canvas>
    <canvas id="coloring2" width="400" height="300"></canvas>
    </div>
	<!-- カラーパレット -->
	<div id="palette">カラーパレット<br />
	</div>
	<div id="penWidth">ペン先<br />
		<button type="button" onClick="setPenSize('20')"><div class="penSize" id="penSizeL"></div></button>
		<button type="button" onClick="setPenSize('10')"><div class="penSize" id="penSizeM"></div></button>
		<button type="button" onClick="setPenSize('3')"><div class="penSize" id="penSizeS"></div></button>

	</div>
</body>
<script type="text/javascript">
	// キャンバスを取得
	var canvas = document.getElementById('coloring');
    var canvas2 = document.getElementById('coloring2');
	// コンテキストを取得
	var ctx    = canvas.getContext('2d');
    var ctx2    = canvas2.getContext('2d');

	// カラーパレット取得
	var palette = document.getElementById('palette');
	// ペンサイズ
	var penSizeButtons = document.getElementsByClassName('penSize');

	// マウス位置
	var mouse = {x:0, y:0, bx:0, by:0,x:0, y:0,};
	// クリック中フラグ
	var isClicked = false;
	// ペン色
	var penColor = "#000000";
	// ペン幅
	var penWidth = 10;

	// マウスイベントを取得
	// マウスクリック
    canvas2.addEventListener("mousedown", function(e){
		// キャンバスの位置とサイズを取得
		var rect = e.target.getBoundingClientRect();

		// マウスの位置
		mouse.x = e.clientX - rect.left;
		mouse.y = e.clientY - rect.top;
		mouse.bx = mouse.x;
		mouse.by = mouse.y;

		// 描画の開始
		drarLineStart();

		// クリック中フラグ
		isClicked = true;
	});

	// 実行
	setColorPalette()


	// マウス移動
	canvas2.addEventListener("mousemove", function(e){
		// クリック中以外の時は無視
		if(!isClicked) {
			return;
		}

		// キャンバスの位置とサイズを取得
		var rect = e.target.getBoundingClientRect();

		// mouse.bx = mouse.x;
		// mouse.by = mouse.y;
		// マウスの位置
		mouse.x = e.clientX - rect.left;
		mouse.y = e.clientY - rect.top;

		// クリック中なら線を引く
		drawLine();
	});

	// マウスクリック解除
	canvas2.addEventListener("mouseup", function(e){
        ctx2.clearRect(0,0,400,300);
        ctx.stroke();
		// クリック終了
		isClicked = false;
	});

	// 開始位置を指定
	function drarLineStart() {
		// 線の太さを指定
		ctx.lineWidth = penWidth;
        ctx2.lineWidth = penWidth;
		// 線の色を指定
		ctx.strokeStyle = penColor;
		ctx.globalAlpha = 0.1;
        ctx2.strokeStyle = penColor;
		ctx2.globalAlpha = 0.1;
		// 今からパスを書きますよと云う宣言
		ctx.beginPath();
        ctx2.beginPath();
		// 先端を丸くする
		ctx.lineCap = "butt"
        ctx2.lineCap = "butt"
		ctx.lineJoin = "round"
		ctx2.lineJoin = "round"
		// パスの開始点に移動
		ctx.moveTo(mouse.x, mouse.y);
        
	}

	// 線を引く
	function drawLine() {
		// 指定の位置までパスを引く
		ctx.lineTo(mouse.x, mouse.y);
		// パスに線を載せる
		ctx2.clearRect(0,0,400,300);
		ctx2.lineTo(mouse.x, mouse.y);
		ctx2.stroke();
	}

	// パレットを配置する
	function setColorPalette() {
		var colors = ['#FFFFFF', '#000000', '#663300', '#339933', '#00FF99', '#00FFFF',
				 '#0000FF', '#9900FF', '#FFFF00', '#FF9900', '#FF99FF', '#FF0000'];

		for(var i = 0; i < 12; i++) {
			var btn = "<button class='Color' style='background-color: " + colors[i] + ";' onClick='setPenColor(\"" + colors[i] + "\");'></button>"
			palette.innerHTML += btn;
		}
	}

	// 色を変更する
	function setPenColor(setColor) {
		// var setColor = '#FF0000';
		console.log("setPenColor" + setColor);
		penColor = setColor;
		// ペンの色を変える
		for(var i = 0; i < penSizeButtons.length; i++) {
			penSizeButtons[i].style.backgroundColor = setColor;
		}
	}

	// 線幅を変更する
	function setPenSize(size) {
		console.log("penSize " + size);
		penWidth = size;
	}
</script>
</html>